{"title":"weexæ¡†æ¶æµ…æ","uid":"0c8fa70d5490d97115738363a2ade7ea","slug":"weex","date":"2022-01-24T08:08:07.333Z","updated":"2022-04-02T08:13:37.541Z","comments":true,"path":"api/articles/weex.json","keywords":null,"cover":"https://images.unsplash.com/photo-1535476593072-5a085be9f713?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8ODB8fGFuaW1hbCUyMGxvdmV8ZW58MHx8MHx8&auto=format&fit=crop&w=500&q=60","content":"<h2 id=\"1-è·¨ç«¯æ¡†æ¶\"><a href=\"#1-è·¨ç«¯æ¡†æ¶\" class=\"headerlink\" title=\"1.è·¨ç«¯æ¡†æ¶\"></a>1.è·¨ç«¯æ¡†æ¶</h2><h3 id=\"react-nativeã€fluterå’Œweex\"><a href=\"#react-nativeã€fluterå’Œweex\" class=\"headerlink\" title=\"react-nativeã€fluterå’Œweex\"></a>react-nativeã€fluterå’Œweex</h3><p>React-native: åŸºäº js å¼•æ“ï¼Œé€šè¿‡ bridge æ³¨å…¥ä¸€äº›è®¾å¤‡èƒ½åŠ›çš„ apiï¼Œè€Œæ¸²æŸ“è·¨ç«¯åˆ™æ˜¯ä½¿ç”¨å®‰å“ã€ios å®ç° react çš„ virtual dom çš„æ¸²æŸ“ã€‚</p>\n<p>Weex: jsæ¡†æ¶æ›´ç±»ä¼¼äºvueï¼Œå…¶ä»–æ¶æ„ä¸RNç±»ä¼¼ï¼Œä¹Ÿæ˜¯é€šè¿‡bridgeå‘å®‰å“å’Œioså‘é€æ¶ˆæ¯å®ç°apiçš„è°ƒç”¨</p>\n<p>flutter: æ¸²æŸ“ä¸æ˜¯åŸºäºæ“ä½œç³»ç»Ÿçš„ç»„ä»¶ï¼Œè€Œæ˜¯ç›´æ¥åŸºäºç»˜å›¾åº“ï¼ˆskiaï¼‰æ¥ç»˜åˆ¶çš„ï¼Œè¿™æ ·åšåˆ°äº†æ¸²æŸ“çš„è·¨ç«¯ã€‚é€»è¾‘çš„è·¨ç«¯ä¹Ÿä¸æ˜¯åŸºäº js å¼•æ“ï¼Œè€Œæ˜¯è‡ªç ”çš„ dart vm æ¥è·¨ç«¯ï¼Œé€šè¿‡ dart è¯­è¨€æ¥å†™é€»è¾‘</p>\n<p>![image-20211009164255894](/Users/shuanghuili/Library/Application Support/typora-user-images/image-20211009164255894.png)</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th><strong>Flutter</strong></th>\n<th><strong>React Native</strong></th>\n<th><strong>è¯„ä»·</strong></th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>ç¼–ç¨‹è¯­è¨€</strong></td>\n<td>Dart</td>\n<td>JS</td>\n<td>JSè¯­è¨€ç”Ÿæ€æ›´å¥½  Dartå­¦ä¹ æˆæœ¬ä¹Ÿä¸é«˜ï¼Œæ”¯æŒJITä¸AOT</td>\n</tr>\n<tr>\n<td>Nativeé€šä¿¡</td>\n<td>Skia</td>\n<td>JavaScript-bridge</td>\n<td>RNåœ¨UIæ¸²æŸ“è·¯å¾„è¾ƒé•¿  Flutteræ¸²æŸ“æ€§èƒ½åœ¨è·¯å¾„ä¸Šå ªæ¯”åŸç”Ÿ</td>\n</tr>\n<tr>\n<td>UIç»„ä»¶ä¸API</td>\n<td>SDK</td>\n<td>æ¡†æ¶ï¼ˆframeworkï¼‰</td>\n<td>Flutterï¼šMaterial &amp; Cupertino &amp; testing  &amp;  navigationã€åŒ…çš„å°ºå¯¸æ›´å¤§  RNï¼šDependent  on 3rd-party libraries</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n<h2 id=\"2-weex\"><a href=\"#2-weex\" class=\"headerlink\" title=\"2.weex\"></a>2.weex</h2><h3 id=\"æ€»ä½“çš„æ¡†æ¶å›¾\"><a href=\"#æ€»ä½“çš„æ¡†æ¶å›¾\" class=\"headerlink\" title=\"æ€»ä½“çš„æ¡†æ¶å›¾\"></a>æ€»ä½“çš„æ¡†æ¶å›¾</h3><p><img src=\"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c0b8881d8d894efea24ba411376361d8~tplv-k3u1fbpfcp-watermark.awebp\" alt=\"img\"></p>\n<h3 id=\"weex-Jsfm\"><a href=\"#weex-Jsfm\" class=\"headerlink\" title=\"weex-Jsfm\"></a>weex-Jsfm</h3><p>ä»ä¸€ä¸ªç®€å•çš„weexæ–‡ä»¶æ¥è®²è§£weex-jsfmåšäº†å“ªäº›å¤„ç†</p>\n<p>æ‰“åŒ…å‰çš„æ–‡ä»¶</p>\n<p>é¦–å…ˆå¯ä»¥çœ‹ä¸€ä¸‹æ¡†æ¶çš„ç›®å½•ç»“æ„</p>\n<p>![æˆªå±2021-10-09 ä¸‹åˆ5.20.43](/Users/shuanghuili/Library/Application Support/typora-user-images/æˆªå±2021-10-09 ä¸‹åˆ5.20.43.png)</p>\n<h4 id=\"entries\"><a href=\"#entries\" class=\"headerlink\" title=\"entries\"></a>entries</h4><p>é¦–å…ˆç¬¬ä¸€æ­¥ä¸ºåˆå§‹åŒ–å‰ç«¯æ¡†æ¶ï¼ˆVueï¼ŒVanillaï¼ŒRaxå’Œ Weexï¼‰ï¼Œæ³¨å†Œå‰ç«¯å…¨å±€æ–¹æ³•ä¾›æ¡†æ¶ä½¿ç”¨</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> freezePrototype <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./env'</span>\n<span class=\"token keyword\">import</span> setup <span class=\"token keyword\">from</span> <span class=\"token string\">'./setup'</span>\n<span class=\"token keyword\">import</span> frameworks <span class=\"token keyword\">from</span> <span class=\"token string\">'../frameworks'</span>\n\n<span class=\"token function\">setup</span><span class=\"token punctuation\">(</span>frameworks<span class=\"token punctuation\">)</span>\n<span class=\"token function\">freezePrototype</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>å†çœ‹ä¸‹æ˜¯å¦‚ä½•setUpæ¡†æ¶çš„å‘¢ï¼Œé¦–å…ˆæ³¨å†Œæ¡†æ¶çš„ä¿¡æ¯ï¼Œç„¶åç”¨initå‡½æ•°åˆå§‹åŒ–æ¡†æ¶çš„é…ç½®ï¼Œæœ€åå°†æ–¹æ³•æ³¨å†Œä¸ºå…¨å±€APIä¾›æ¡†æ¶ä½¿ç”¨ã€‚</p>\n<pre class=\"line-numbers language-js\" data-language=\"js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">frameworks</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span> init<span class=\"token punctuation\">,</span> config <span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> runtime\n  config<span class=\"token punctuation\">.</span>frameworks <span class=\"token operator\">=</span> frameworks\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span> native<span class=\"token punctuation\">,</span> transformer <span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> subversion\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> serviceName <span class=\"token keyword\">in</span> services<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    runtime<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span>serviceName<span class=\"token punctuation\">,</span> services<span class=\"token punctuation\">[</span>serviceName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">&#125;</span>\n\n  runtime<span class=\"token punctuation\">.</span><span class=\"token function\">freezePrototype</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// register framework meta info</span>\n  global<span class=\"token punctuation\">.</span>frameworkVersion <span class=\"token operator\">=</span> native\n  global<span class=\"token punctuation\">.</span>transformerVersion <span class=\"token operator\">=</span> transformer\n\n  <span class=\"token comment\">// init frameworks</span>\n  <span class=\"token keyword\">const</span> globalMethods <span class=\"token operator\">=</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// set global methods</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> methodName <span class=\"token keyword\">in</span> globalMethods<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    global<span class=\"token punctuation\">[</span>methodName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span>args</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token keyword\">const</span> ret <span class=\"token operator\">=</span> globalMethods<span class=\"token punctuation\">[</span>methodName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ret <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>ret<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token keyword\">return</span> ret\n    <span class=\"token punctuation\">&#125;</span>\n  <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>å¯ä»¥çœ‹åˆ°setupå‡½æ•°ä½¿ç”¨initå‡½æ•°æ¥åˆå§‹åŒ–æ¡†æ¶ï¼Œè€Œinitå‡½æ•°ä¸­ä½¿ç”¨initTaskHandlerå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åˆå§‹åŒ–ä»»åŠ¡å¤„ç†ä¸­å¿ƒçš„æ–¹æ³•ï¼Œæ˜¯brige/TaskCenter.jsä¸­çš„initå‡½æ•°</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">init</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">config</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n  runtimeConfig <span class=\"token operator\">=</span> config <span class=\"token operator\">||</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>\n  frameworks <span class=\"token operator\">=</span> runtimeConfig<span class=\"token punctuation\">.</span>frameworks <span class=\"token operator\">||</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>\n  <span class=\"token comment\">// åˆå§‹åŒ–ä»»åŠ¡å¤„ç†ä¸­å¿ƒ</span>\n  <span class=\"token function\">initTaskHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// Init each framework by `init` method and `config` which contains three</span>\n  <span class=\"token comment\">// virtual-DOM Class: `Document`, `Element` &amp; `Comment`, and a JS bridge method:</span>\n  <span class=\"token comment\">// `sendTasks(...args)`.</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> name <span class=\"token keyword\">in</span> frameworks<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">const</span> framework <span class=\"token operator\">=</span> frameworks<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> framework<span class=\"token punctuation\">.</span>init <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span>\n        framework<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">&#125;</span>\n      <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n  <span class=\"token punctuation\">&#125;</span>\n\n  <span class=\"token function\">adaptMethod</span><span class=\"token punctuation\">(</span><span class=\"token string\">'registerComponents'</span><span class=\"token punctuation\">,</span> registerComponents<span class=\"token punctuation\">)</span>\n  <span class=\"token function\">adaptMethod</span><span class=\"token punctuation\">(</span><span class=\"token string\">'registerModules'</span><span class=\"token punctuation\">,</span> registerModules<span class=\"token punctuation\">)</span>\n  <span class=\"token function\">adaptMethod</span><span class=\"token punctuation\">(</span><span class=\"token string\">'registerMethods'</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token punctuation\">;</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'destroyInstance'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'refreshInstance'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>genInstance<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> methods\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"brige\"><a href=\"#brige\" class=\"headerlink\" title=\"brige\"></a>brige</h4><p>jsä¸nativeä¾§é€šä¿¡çš„æ¡¥æ¢</p>\n<p>è¿™ä¸ªå‡½æ•°ä¸ºTaskCenterç±»çš„åŸå‹ä¸ŠæŒ‚è½½äº†è¯¸å¤šå¯¹å¤–çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•æœ€ç»ˆæ˜¯è°ƒç”¨çš„åŸç”Ÿæ–¹æ³•å¤„ç†ã€‚</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">init</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">DOM_METHODS</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token literal-property property\">createFinish</span><span class=\"token operator\">:</span> global<span class=\"token punctuation\">.</span>callCreateFinish<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">updateFinish</span><span class=\"token operator\">:</span> global<span class=\"token punctuation\">.</span>callUpdateFinish<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">refreshFinish</span><span class=\"token operator\">:</span> global<span class=\"token punctuation\">.</span>callRefreshFinish<span class=\"token punctuation\">,</span>\n\n    <span class=\"token literal-property property\">createBody</span><span class=\"token operator\">:</span> global<span class=\"token punctuation\">.</span>callCreateBody<span class=\"token punctuation\">,</span>\n\n    <span class=\"token literal-property property\">addElement</span><span class=\"token operator\">:</span> global<span class=\"token punctuation\">.</span>callAddElement<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">removeElement</span><span class=\"token operator\">:</span> global<span class=\"token punctuation\">.</span>callRemoveElement<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">moveElement</span><span class=\"token operator\">:</span> global<span class=\"token punctuation\">.</span>callMoveElement<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">updateAttrs</span><span class=\"token operator\">:</span> global<span class=\"token punctuation\">.</span>callUpdateAttrs<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">updateStyle</span><span class=\"token operator\">:</span> global<span class=\"token punctuation\">.</span>callUpdateStyle<span class=\"token punctuation\">,</span>\n\n    <span class=\"token literal-property property\">addEvent</span><span class=\"token operator\">:</span> global<span class=\"token punctuation\">.</span>callAddEvent<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">removeEvent</span><span class=\"token operator\">:</span> global<span class=\"token punctuation\">.</span>callRemoveEvent<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">__updateComponentData</span><span class=\"token operator\">:</span> global<span class=\"token punctuation\">.</span>__updateComponentData\n  <span class=\"token punctuation\">&#125;</span>\n  <span class=\"token keyword\">const</span> proto <span class=\"token operator\">=</span> <span class=\"token class-name\">TaskCenter</span><span class=\"token punctuation\">.</span>prototype\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> name <span class=\"token keyword\">in</span> <span class=\"token constant\">DOM_METHODS</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">const</span> method <span class=\"token operator\">=</span> <span class=\"token constant\">DOM_METHODS</span><span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span>\n    proto<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> method <span class=\"token operator\">?</span>\n      <span class=\"token punctuation\">(</span><span class=\"token parameter\">id<span class=\"token punctuation\">,</span> args</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">method</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span>\n      <span class=\"token punctuation\">(</span><span class=\"token parameter\">id<span class=\"token punctuation\">,</span> args</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fallback</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">module</span><span class=\"token operator\">:</span> <span class=\"token string\">'dom'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> name<span class=\"token punctuation\">,</span> args <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-1'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">&#125;</span>\n\n  proto<span class=\"token punctuation\">.</span>componentHandler <span class=\"token operator\">=</span> global<span class=\"token punctuation\">.</span>callNativeComponent <span class=\"token operator\">||</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id<span class=\"token punctuation\">,</span> ref<span class=\"token punctuation\">,</span> method<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">,</span> options</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n      <span class=\"token function\">fallback</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">component</span><span class=\"token operator\">:</span> options<span class=\"token punctuation\">.</span>component<span class=\"token punctuation\">,</span> ref<span class=\"token punctuation\">,</span> method<span class=\"token punctuation\">,</span> args <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n  proto<span class=\"token punctuation\">.</span>moduleHandler <span class=\"token operator\">=</span> global<span class=\"token punctuation\">.</span>callNativeModule <span class=\"token operator\">||</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id<span class=\"token punctuation\">,</span> module<span class=\"token punctuation\">,</span> method<span class=\"token punctuation\">,</span> args</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n      <span class=\"token function\">fallback</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span> module<span class=\"token punctuation\">,</span> method<span class=\"token punctuation\">,</span> args <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>ç„¶åå°†è¿™äº›æ–¹æ³•åº”ç”¨åˆ°removeChildæ–¹æ³•ä¸Šï¼Œå½“æˆ‘ä»¬è°ƒç”¨å…ƒç´ removeChildæ–¹æ³•çš„æ—¶å€™å°±ä¼šå¯¹åº”åˆ°taskCenter.sendæ–¹æ³•ï¼Œè®²éœ€è¦å‘é€çš„æŒ‡ä»¤å‘é€ç»™å®¢æˆ·ç«¯ä»è€Œè¿›è¡Œåˆ é™¤å­å…ƒç´ çš„æ–¹æ³•ï¼Œè€Œåƒè¿™æ ·å†™å…ƒç´ appendChildï¼ŒinsertBeforeå’ŒinsertAfterç­‰æ–¹æ³•çš„æ–‡ä»¶éƒ½åœ¨vdomæ–‡ä»¶å¤¹é‡Œé¢ã€‚</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/**\n  * Remove a child node, and decide whether it should be destroyed.\n  * @param &#123;object&#125; node\n  * @param &#123;boolean&#125; preserved\n  */</span>\n <span class=\"token class-name\">Element</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">removeChild</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token function\">removeChild</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">node<span class=\"token punctuation\">,</span> preserved</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n     <span class=\"token function\">removeIndex</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n     <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>nodeType <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n       <span class=\"token function\">removeIndex</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pureChildren<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       <span class=\"token keyword\">var</span> taskCenter <span class=\"token operator\">=</span> <span class=\"token function\">getTaskCenter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>docId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>taskCenter<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n         taskCenter<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>\n           <span class=\"token string\">'dom'</span><span class=\"token punctuation\">,</span>\n           <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">action</span><span class=\"token operator\">:</span> <span class=\"token string\">'removeElement'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>\n           <span class=\"token punctuation\">[</span>node<span class=\"token punctuation\">.</span>ref<span class=\"token punctuation\">]</span>\n         <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       <span class=\"token punctuation\">&#125;</span>\n     <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token punctuation\">&#125;</span>\n   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>preserved<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n     node<span class=\"token punctuation\">.</span><span class=\"token function\">destroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">&#125;</span>\n <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"vdom\"><a href=\"#vdom\" class=\"headerlink\" title=\"vdom\"></a>vdom</h4><p>virtual domçš„å®ç°ï¼Œå…¶ä¸­åŒ…æ‹¬æ³¨é‡ŠèŠ‚ç‚¹ã€weexå…ƒç´ ï¼Œæµè§ˆå™¨çš„documentï¼Œè‡ªå®šä¹‰elementèŠ‚ç‚¹ã€‚ä¾‹å¦‚åŸç”ŸweexèŠ‚ç‚¹ï¼Œå°±æ˜¯ç›´æ¥å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯æ¥æ³¨å†Œè¯¥å…ƒç´ ã€‚</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">registerElement</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">type<span class=\"token punctuation\">,</span> methods</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token comment\">// Skip when no special component methods.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>Array<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>methods<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>methods<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">return</span>\n  <span class=\"token punctuation\">&#125;</span>\n\n  <span class=\"token comment\">// Init constructor.</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">WeexElement</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Element</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>\n\n  <span class=\"token comment\">// Add methods to prototype.</span>\n  methods<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">methodName</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token class-name\">WeexElement</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">[</span>methodName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span>args</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n      <span class=\"token keyword\">const</span> taskCenter <span class=\"token operator\">=</span> <span class=\"token function\">getTaskCenter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>docId<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>taskCenter<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> taskCenter<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'component'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span>\n          <span class=\"token literal-property property\">ref</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ref<span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">component</span><span class=\"token operator\">:</span> type<span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> methodName\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n\n<p>æœ€åæ€»ç»“æµç¨‹å›¾å¦‚ä¸‹</p>\n<p>ä»¥weex-vue-frameworkä¸ºä¾‹ä¸»è¦åšäº†å¦‚ä¸‹å‡ ä»¶äº‹ï¼š</p>\n<ol>\n<li><p>createInstanceContext</p>\n<p>åˆ›å»ºå®ä¾‹ï¼Œå¤„ç†weexå®ä¾‹</p>\n</li>\n<li><p>createVueModuleInstance</p>\n<p>åˆ›å»ºVueå®ä¾‹ï¼Œå¹¶åšå¯¹weexçš„é€‚é…</p>\n</li>\n<li><p>æŒ‚è½½weexæä¾›çš„apiåˆ°Vueå®ä¾‹ä¸Šï¼Œå¦‚documentï¼ŒtaskCenterç­‰</p>\n</li>\n<li><p>å½“vueç”Ÿæˆè™šæ‹Ÿdomçš„æ—¶å€™å°±å¯ä»¥ç›´æ¥è°ƒç”¨æŒ‚è½½åœ¨å®ä¾‹ä¸Šçš„æ–¹æ³•ï¼Œè¿›è¡Œç»„ä»¶çš„åˆ›å»ºï¼Œç„¶åå‘æ¡¥å‘é€æ¶ˆæ¯ç”±å®¢æˆ·ç«¯æœ€ç»ˆè¿›è¡Œç»„ä»¶çš„åˆ›å»º</p>\n</li>\n</ol>\n<p>![image-20211013194158430](/Users/shuanghuili/Library/Application Support/typora-user-images/image-20211013194158430.png)</p>\n","text":"1.è·¨ç«¯æ¡†æ¶react-nativeã€fluterå’ŒweexReact-native: åŸºäº js å¼•æ“ï¼Œé€šè¿‡ bridge æ³¨å…¥ä¸€äº›è®¾å¤‡èƒ½åŠ›çš„ apiï¼Œè€Œæ¸²æŸ“è·¨ç«¯åˆ™æ˜¯ä½¿ç”¨å®‰å“ã€ios å®ç° react çš„ virtual dom çš„æ¸²æŸ“ã€‚ Weex: jsæ¡†æ¶æ›´ç±»ä¼¼äºvueï¼Œå…¶...","link":"","photos":[],"count_time":{"symbolsCount":"6.2k","symbolsTime":"6 mins."},"categories":[{"name":"æ¡†æ¶","slug":"æ¡†æ¶","count":1,"path":"api/categories/æ¡†æ¶.json"}],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-%E8%B7%A8%E7%AB%AF%E6%A1%86%E6%9E%B6\"><span class=\"toc-text\">1.è·¨ç«¯æ¡†æ¶</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#react-native%E3%80%81fluter%E5%92%8Cweex\"><span class=\"toc-text\">react-nativeã€fluterå’Œweex</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#2-weex\"><span class=\"toc-text\">2.weex</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%80%BB%E4%BD%93%E7%9A%84%E6%A1%86%E6%9E%B6%E5%9B%BE\"><span class=\"toc-text\">æ€»ä½“çš„æ¡†æ¶å›¾</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#weex-Jsfm\"><span class=\"toc-text\">weex-Jsfm</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#entries\"><span class=\"toc-text\">entries</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#brige\"><span class=\"toc-text\">brige</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#vdom\"><span class=\"toc-text\">vdom</span></a></li></ol></li></ol></li></ol>","author":{"name":"åŠ¨ç‰©å›­å›­é•¿","slug":"blog-author","avatar":"https://images.unsplash.com/photo-1616207787467-20787d4cbf8a?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MjEzfHxhbmltYWwlMjBsb3ZlfGVufDB8fDB8fA%3D%3D&auto=format&fit=crop&w=500&q=60","link":"https://github.com/SkylarShuang","description":"å–œæ¬¢ä»£ç çš„åŠ¨ç‰©å›­å›­é•¿ğŸ’","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"vue nextTickçš„åŸç†","uid":"2a112d259007295f8e773659e0f0b890","slug":"Vue nextTickçš„åŸç†","date":"2022-04-01T12:06:02.451Z","updated":"2022-04-02T03:34:28.770Z","comments":true,"path":"api/articles/Vue nextTickçš„åŸç†.json","keywords":null,"cover":"https://media.istockphoto.com/photos/dog-dreaming-picture-id1323095288?k=20&m=1323095288&s=612x612&w=0&h=ZC2DNmAcpDlMlNof1ojUXpItMhXggVfXFqnIZHU3NX4=","text":"Vue nextTickçš„åŸç†ä½¿ç”¨æ–¹æ³•åœ¨ä¸‹æ¬¡ DOM æ›´æ–°å¾ªç¯ç»“æŸä¹‹åæ‰§è¡Œå»¶è¿Ÿå›è°ƒã€‚åœ¨ä¿®æ”¹æ•°æ®ä¹‹åç«‹å³ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè·å–æ›´æ–°åçš„ DOM // ä¿®æ”¹æ•°æ® vm.msg = 'Hello' // DOM è¿˜æ²¡æœ‰æ›´æ–° Vue.nextTick(function () &#123; /...","link":"","photos":[],"count_time":{"symbolsCount":"3.2k","symbolsTime":"3 mins."},"categories":[{"name":"Vue","slug":"Vue","count":3,"path":"api/categories/Vue.json"}],"tags":[],"author":{"name":"åŠ¨ç‰©å›­å›­é•¿","slug":"blog-author","avatar":"https://images.unsplash.com/photo-1616207787467-20787d4cbf8a?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MjEzfHxhbmltYWwlMjBsb3ZlfGVufDB8fDB8fA%3D%3D&auto=format&fit=crop&w=500&q=60","link":"https://github.com/SkylarShuang","description":"å–œæ¬¢ä»£ç çš„åŠ¨ç‰©å›­å›­é•¿ğŸ’","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{}}